<!DOCTYPE html>
<html lang="fr-CA">
  <head>
    <meta charset="utf-8" />
    <title>Démo combinée — date & datetime-local ↔ LocalStorage</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 860px;
        margin: 2rem auto;
      }
      fieldset {
        border: 1px solid #ccc;
        padding: 1rem;
        margin-bottom: 1.5rem;
      }
      legend {
        font-weight: 600;
      }
      label {
        display: block;
        margin: 0.5rem 0 0.25rem;
        font-weight: 500;
      }
      input[type='date'],
      input[type='datetime-local'] {
        font-size: 1rem;
        padding: 0.4rem 0.5rem;
      }
      button {
        padding: 0.5rem 0.9rem;
        margin-right: 0.5rem;
        cursor: pointer;
      }
      .row {
        margin: 0.75rem 0;
      }
      .out {
        background: #f7f7f7;
        border: 1px solid #ddd;
        padding: 1rem;
        white-space: pre-wrap;
      }
      .two {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        align-items: start;
      }
      @media (max-width: 820px) {
        .two {
          grid-template-columns: 1fr;
        }
      }
      .small {
        color: #666;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <h1>Conversion combinée — Date & Date+Heure ↔ LocalStorage</h1>
    <p class="small">
      • <code>type="date"</code> attend <strong>YYYY-MM-DD</strong> •
      <code>type="datetime-local"</code> attend <strong>YYYY-MM-DDTHH:mm</strong
      ><br />
      • Stockage en <strong>ISO UTC</strong> (toISOString) • Affichage local via
      <strong>Intl.DateTimeFormat</strong>
    </p>

    <div class="two">
      <!-- Bloc DATE -->
      <section>
        <fieldset>
          <legend>Bloc A — Date seulement</legend>

          <label for="d">Date</label>
          <input id="d" type="date" aria-describedby="dHelp" />
          <p id="dHelp" class="small">
            Format attendu : <code>YYYY-MM-DD</code>
          </p>

          <div class="row">
            <button id="aToday" type="button">Aujourd’hui</button>
            <button id="aSave" type="button">Enregistrer (ISO UTC)</button>
            <button id="aLoad" type="button">Recharger</button>
            <button id="aClear" type="button">Vider</button>
          </div>

          <div id="aOut" class="out" aria-live="polite">
            Aucune action (bloc A).
          </div>
        </fieldset>
      </section>

      <!-- Bloc DATETIME-LOCAL -->
      <section>
        <fieldset>
          <legend>Bloc B — Date + heure</legend>

          <label for="dtl">Date & heure (locales)</label>
          <input id="dtl" type="datetime-local" aria-describedby="dtlHelp" />
          <p id="dtlHelp" class="small">
            Format attendu : <code>YYYY-MM-DDTHH:mm</code>
          </p>

          <div class="row">
            <button id="bNow" type="button">Maintenant</button>
            <button id="bSave" type="button">Enregistrer (ISO UTC)</button>
            <button id="bLoad" type="button">Recharger</button>
            <button id="bClear" type="button">Vider</button>
          </div>

          <div id="bOut" class="out" aria-live="polite">
            Aucune action (bloc B).
          </div>
        </fieldset>
      </section>
    </div>

    <script>
      // Clés LocalStorage
      const KEY_DATE = 'demo.date.iso';
      const KEY_DTL = 'demo.datetime.iso';

      // Helpers de conversion (Date -> valeur d'input)
      const toInputDateValue = (date) => date.toISOString().slice(0, 10); // "YYYY-MM-DD"
      const toInputDTLValue = (date) => date.toISOString().slice(0, 16); // "YYYY-MM-DDTHH:mm"

      // Formateurs d'affichage local (lisible humain)
      const fmtDate = (d) =>
        new Intl.DateTimeFormat('fr-CA', { dateStyle: 'full' }).format(d);
      const fmtDateT = (d) =>
        new Intl.DateTimeFormat('fr-CA', {
          dateStyle: 'full',
          timeStyle: 'short',
        }).format(d);

      // Sélecteurs
      const inputD = document.getElementById('d');
      const inputDTL = document.getElementById('dtl');
      const aOut = document.getElementById('aOut');
      const bOut = document.getElementById('bOut');

      // ---- Bloc A (DATE) ----
      document.getElementById('aToday').addEventListener('click', () => {
        const now = new Date();
        inputD.value = toInputDateValue(now);
        aOut.textContent = `Aujourd’hui appliqué
- Champ (YYYY-MM-DD) : ${inputD.value}
- ISO (UTC)          : ${now.toISOString()}
- Affichage local    : ${fmtDate(now)}`;
      });

      document.getElementById('aSave').addEventListener('click', () => {
        if (!inputD.value) {
          aOut.textContent = 'Choisis une date d’abord.';
          inputD.focus();
          return;
        }
        // "YYYY-MM-DD" -> Date (interprétée en local à minuit)
        const d = new Date(inputD.value);
        const iso = d.toISOString(); // Stockage en UTC
        localStorage.setItem(KEY_DATE, iso);
        aOut.textContent = `Enregistré (bloc A)
- Champ (YYYY-MM-DD) : ${inputD.value}
- ISO (UTC)          : ${iso}
- Affichage local    : ${fmtDate(d)}`;
      });

      document.getElementById('aLoad').addEventListener('click', () => {
        const iso = localStorage.getItem(KEY_DATE);
        if (!iso) {
          aOut.textContent = 'Aucune date enregistrée (bloc A).';
          return;
        }
        const d = new Date(iso); // ISO UTC → Date locale
        inputD.value = toInputDateValue(d); // Date -> "YYYY-MM-DD"
        aOut.textContent = `Rechargé (bloc A)
- ISO lu (UTC)       : ${iso}
- Réinjecté (input)  : ${inputD.value}
- Affichage local    : ${fmtDate(d)}`;
      });

      document.getElementById('aClear').addEventListener('click', () => {
        localStorage.removeItem(KEY_DATE);
        inputD.value = '';
        aOut.textContent = 'Données effacées (bloc A).';
      });

      // ---- Bloc B (DATETIME-LOCAL) ----
      document.getElementById('bNow').addEventListener('click', () => {
        const now = new Date();
        inputDTL.value = toInputDTLValue(now);
        bOut.textContent = `Maintenant appliqué
- Champ (YYYY-MM-DDTHH:mm) : ${inputDTL.value}
- ISO (UTC)                : ${now.toISOString()}
- Affichage local          : ${fmtDateT(now)}`;
      });

      document.getElementById('bSave').addEventListener('click', () => {
        if (!inputDTL.value) {
          bOut.textContent = 'Choisis une date/heure d’abord.';
          inputDTL.focus();
          return;
        }
        // "YYYY-MM-DDTHH:mm" -> Date locale
        const dt = new Date(inputDTL.value);
        const iso = dt.toISOString(); // Stockage en UTC
        localStorage.setItem(KEY_DTL, iso);
        bOut.textContent = `Enregistré (bloc B)
- Champ (YYYY-MM-DDTHH:mm) : ${inputDTL.value}
- ISO (UTC)                : ${iso}
- Affichage local          : ${fmtDateT(dt)}`;
      });

      document.getElementById('bLoad').addEventListener('click', () => {
        const iso = localStorage.getItem(KEY_DTL);
        if (!iso) {
          bOut.textContent = 'Aucune date/heure enregistrée (bloc B).';
          return;
        }
        const dt = new Date(iso); // ISO UTC → Date locale
        inputDTL.value = toInputDTLValue(dt); // Date -> "YYYY-MM-DDTHH:mm"
        bOut.textContent = `Rechargé (bloc B)
- ISO lu (UTC)                : ${iso}
- Réinjecté (input)          : ${inputDTL.value}
- Affichage local            : ${fmtDateT(dt)}`;
      });

      document.getElementById('bClear').addEventListener('click', () => {
        localStorage.removeItem(KEY_DTL);
        inputDTL.value = '';
        bOut.textContent = 'Données effacées (bloc B).';
      });

      // Init : pré-remplir si des données existent
      (function init() {
        const isoA = localStorage.getItem(KEY_DATE);
        if (isoA) {
          const d = new Date(isoA);
          inputD.value = toInputDateValue(d);
          aOut.textContent = `Préchargé (bloc A)
- ISO (UTC)       : ${isoA}
- Champ (input)   : ${inputD.value}
- Affichage local : ${fmtDate(d)}`;
        }
        const isoB = localStorage.getItem(KEY_DTL);
        if (isoB) {
          const dt = new Date(isoB);
          inputDTL.value = toInputDTLValue(dt);
          bOut.textContent = `Préchargé (bloc B)
- ISO (UTC)       : ${isoB}
- Champ (input)   : ${inputDTL.value}
- Affichage local : ${fmtDateT(dt)}`;
        }
      })();
    </script>
  </body>
</html>
